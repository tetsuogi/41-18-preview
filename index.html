<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>縦書き原稿プレビュー</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body {
        font-family: 'Hiragino Mincho ProN', 'MS Mincho', serif;
    }
    .manuscript-page {
        writing-mode: vertical-rl;
        border: 1px solid #ccc;
        padding: 20px;
        margin: 10px;
        box-sizing: border-box;
        font-size: 16px;
        line-height: 1.8;
        letter-spacing: 0.1em;
        width: 551px;
        height: 754px;
        overflow: hidden;
        white-space: pre-wrap;
        flex-shrink: 0;
    }
    #preview-area {
        display: flex;
        flex-wrap: wrap-reverse;
        justify-content: flex-end;
    }
</style>
</head>
<body class="bg-gray-100 p-8">
    <div class="container mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold mb-4">縦書き原稿プレビュー</h1>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <textarea id="text-input" class="w-full h-96 p-4 border rounded-md" placeholder="ここにテキストを入力してください..."></textarea>
                <button id="convert-btn" class="mt-4 w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600">変換</button>
            </div>
            <div>
                <div id="result" class="mb-4 text-lg font-semibold"></div>
                <div id="preview-container" class="border p-4 h-96 overflow-auto bg-gray-50 rounded-md">
                    <div id="preview-area" class="flex flex-row-reverse flex-wrap justify-end">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('convert-btn').addEventListener('click', updatePreview);

        function updatePreview() {
            const text = document.getElementById('text-input').value;
            const previewArea = document.getElementById('preview-area');
            const resultDiv = document.getElementById('result');
            previewArea.innerHTML = '';

            const maxLinesPerPage = 18;
            const maxCharsPerLine = 41;

            if (!text) {
                resultDiv.textContent = 'ページ数: 0ページ';
                return;
            }

            // 【変更点】禁則処理を無効にしたシンプルな行分割ロジック
            function splitTextIntoLines(inputText) {
                const lines = [];
                for (let i = 0; i < inputText.length; i += maxCharsPerLine) {
                    lines.push(inputText.substring(i, i + maxCharsPerLine));
                }
                return lines;
            }

            const paragraphs = text.split('\n');
            let allLines = [];
            paragraphs.forEach(p => {
                if (p === '') {
                    allLines.push('');
                } else {
                    allLines = allLines.concat(splitTextIntoLines(p));
                }
            });


            const totalPages = Math.ceil(allLines.length / maxLinesPerPage);
            resultDiv.textContent = `ページ数: ${totalPages}ページ`;

            for (let i = 0; i < totalPages; i++) {
                const pageDiv = document.createElement('div');
                pageDiv.className = 'manuscript-page';
                const startLine = i * maxLinesPerPage;
                const endLine = startLine + maxLinesPerPage;
                const pageLines = allLines.slice(startLine, endLine);
                pageDiv.textContent = pageLines.join('\n');
                previewArea.appendChild(pageDiv);
            }
        }
    </script>
</body>
</html>
