<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>縦書き原稿ページ計算アプリ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Inter', 'Noto Sans JP', sans-serif;
    }
    .manuscript-page {
      writing-mode: vertical-rl;
      text-orientation: upright;
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 16px;
      line-height: 1.8;
      letter-spacing: 0.1em;
      width: 551px;
      height: 800px; /* 高さを800pxに拡張 */
      border: 1px solid #d1d5db;
      background-color: #ffffff;
      white-space: pre-line;
      word-break: break-all;
      overflow: hidden;
      padding: 16px;
      box-sizing: border-box;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">
  <div class="w-full max-w-7xl mx-auto bg-white rounded-2xl shadow-lg p-6 sm:p-8">
    <div class="text-center mb-6">
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">縦書き原稿ページ計算アプリ</h1>
      <p class="text-gray-500 mt-2">
        テキストを貼り付けて、18行×41文字の縦書きでのページ数を確認します。
      </p>
    </div>
    <div class="mb-6">
      <textarea
        id="text-input"
        class="w-full h-48 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200"
        placeholder="ここにテキストを貼り付けてください..."
      ></textarea>
    </div>
    <div class="flex flex-col sm:flex-row items-center justify-between mb-8">
      <button
        id="calculate-btn"
        class="w-full sm:w-auto bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105 mb-4 sm:mb-0"
      >
        計算する
      </button>
      <div
        id="result"
        class="text-xl sm:text-2xl font-bold text-gray-700 bg-indigo-50 p-3 rounded-lg"
      >
        ページ数: 0 ページ
      </div>
    </div>
    <div>
      <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">プレビュー</h2>
      <div
        id="preview-area"
        class="bg-gray-50 p-4 sm:p-6 rounded-lg min-h-[20rem] flex flex-wrap flex-row-reverse justify-center gap-6"
      ></div>
    </div>
  </div>

  <script>
    const textInput = document.getElementById('text-input');
    const calculateBtn = document.getElementById('calculate-btn');
    const resultDiv = document.getElementById('result');
    const previewArea = document.getElementById('preview-area');

    const CHARS_PER_LINE = 41;
    const MAX_CHARS_PER_LINE = 42;
    const LINES_PER_PAGE = 18;

    function updateManuscript() {
      const text = textInput.value.replace(/\r\n?/g, '\n');
      const totalChars = Array.from(text).length;
      const allLines = [];
      const paragraphs = text.split('\n');

      paragraphs.forEach((para) => {
        if (para.length === 0) {
          allLines.push('');
          return;
        }
        let cursor = 0;
        while (cursor < para.length) {
          const remaining = para.length - cursor;
          if (remaining <= MAX_CHARS_PER_LINE) {
            allLines.push(para.substring(cursor));
            break;
          }
          let end = cursor + CHARS_PER_LINE;
          if (para[end] === '。' || para[end] === '、') {
            end++;
          } else if (para[end - 1] === '「') {
            end--;
          }
          allLines.push(para.substring(cursor, end));
          cursor = end;
        }
      });

      const totalLines = allLines.length;
      const totalPages = totalLines > 0 ? Math.ceil(totalLines / LINES_PER_PAGE) : 1;
      resultDiv.textContent = `ページ数: ${totalPages} ページ (総文字数: ${totalChars})`;

      previewArea.innerHTML = '';
      for (let p = 0; p < totalPages; p++) {
        const pageLines = allLines.slice(p * LINES_PER_PAGE, (p + 1) * LINES_PER_PAGE);
        const pageEl = document.createElement('div');
        pageEl.className = 'manuscript-page';
        const displayLines = pageLines.map((line) => {
          if (line.startsWith('。') || line.startsWith('、')) {
            return line.substring(1);
          }
          return line;
        });
        pageEl.textContent = displayLines.join('\n') || ' ';
        previewArea.appendChild(pageEl);
      }

      if (totalPages === 1 && allLines.length === 0) {
        previewArea.innerHTML = '';
        const emptyEl = document.createElement('div');
        emptyEl.className = 'manuscript-page';
        emptyEl.textContent = ' ';
        previewArea.appendChild(emptyEl);
      }
    }

    calculateBtn.addEventListener('click', updateManuscript);
    updateManuscript();
  </script>
</body>
</html>
